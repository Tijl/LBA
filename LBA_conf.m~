function c = LBA_conf(t, A, b, v, sv)
% Get maximum likelihood estimate for confidence for response i at time t
% given set of LBA parameters
%
% function c = LBA_conf(t, A, b, v, sv)
%
% Model calculates balance of evidence between chosen and unchosen response
% as proxy for confidence (Vickers, 1979). Relies on estimating
% distribution of activation on unchosen integrator , therefore drift rate input (v) should be
% for unchosen option
%
% Maximum likelihood estimate is taken as reported confidence, but you
% could also hack this to work with the full distribution
%
% If t is a 2-element vector, returns marginal confidence numerically integrated over
% this time window
%
% See LBA_mle for definition of parameters
%
% SF 2012

theta = b+A;
z = linspace(1,theta,200);  % activation range over which to estimate pdf
dt = 1;     % millisecond bins over which to calculate integral

if length(t) == 1
    
    confpdf = LBA_wpdf(z,t,A,v,sv);
    try
        c(1) = (max(z) - z(confpdf == max(confpdf)))./max(z);
    catch
        c(1) = median((max(z) - z(confpdf == max(confpdf)))./max(z));
    end
    
elseif length(t) == 2
    
    base = t(1):dt:t(2);
    
    for i = 1:length(base)
        confpdf(:,i) = LBA_wpdf(z,base(i),A,v,sv);
    end
    confpred = mean(confpdf,2); % marginalise over time
    try
        c(1) = (max(z) - z(confpred == max(confpred)))./max(z);
    catch
        c(1) = median((max(z) - z(confpred == max(confpred)))./max(z));
    end
    
else
    fprintf('\n\n\nBad input! See help LBA_conf.\n\n');
    return
end